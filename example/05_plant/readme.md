# 大規模プラント・デジタルツイン・シミュレーション

本プロジェクトは、製造現場における5つの工程（計10基のPLC）を仮想環境上に再現した大規模シミュレーションシステムです。
各装置が独立したModbusサーバーとして動作し、実機さながらの連携動作を検証することが可能です。

## 1. システム構成図

本システムは以下の5層で構成され、各層には1号機・2号機の2ラインが存在します。

| 工程層 | PLC名称 | ポート | 主な制御項目 |
| --- | --- | --- | --- |
| **供給層 (Supply)** | `plc_fuel1,2` / `plc_chem1,2` | 15020-15023 | タンク在庫管理、送液許可判定 |
| **移送層 (Transfer)** | `plc_transfer1,2` | 15024-15025 | ポンプ駆動、流量積算制御 |
| **加工層 (Process)** | `plc_process1,2` | 15026-15027 | ヒーター加熱、攪拌タイマー制御 |
| **成形層 (Molding)** | `plc_molding1,2` | 15028-15029 | プレス降下、型締め保持シーケンス |
| **梱包層 (Packing)** | `plc_packing1,2` | 15030-15031 | コンベア搬送、シーリング、梱包数カウント |

---

## 2. 連携シナリオ：成形・梱包ライン

過去の「プレス・搬送ライン」の設計思想に基づき、本シミュレーションでは以下のインターロック・シーケンスを基本としています。

### シナリオフロー

2.1. **加工完了（成形層）**:
* `plc_molding` が型締め・プレス工程を完了。
* ラダー内の完了フラグ `M0` がONになり、製品の「排出準備完了」を宣言。


2.2. **搬送要求（梱包層）**:
* 梱包層の `device_packing` がワークの到着（X0）を検知。
* `plc_packing` のラダーが働き、コンベア `Y0` を駆動。


2.3. **工程間ハンドシェイク**:
* 梱包機が製品を受け取ると、成形機へ「搬送完了」の信号が渡る（仮想的なインターロック）。
* 成形機は `X1` を受けて次のサイクルへ復帰する。



## 3. ファイル構成

各工程ユニットは、以下の3つのファイルで1セットとなります。

* **`plc_*.yaml`**: PLCの通信設定（Port/Host）およびメモリ確保（X/Y/M/D）。
* **`ladder_*.yaml`**: 制御ロジック（直感ラダー記述）。
* **`device_*.yaml`**: 物理挙動シミュレーション（温度上昇、液位変動、ワーク到着パターン）。



## 4. 運用のポイント

* **ポートの重複厳禁**: 各PLCは独立したポートで動作します。新しい工程を追加する場合は、`modbus.port` が重複しないよう注意してください。
* **メモリ範囲の遵守**: YAMLで定義したメモリ数（例：`X: 10`）を超えるインデックス（`X10`など）をラダーで指定すると、オーバーエラーが発生します。
